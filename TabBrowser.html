<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Windows & Tabs Visualization</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #444;
        }

        .input-section {
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .json-input {
            width: 100%;
            height: 200px;
            padding: 10px;
            font-family: monospace;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .button {
            padding: 8px 16px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .button:hover {
            background-color: #3367d6;
        }

        .button.secondary {
            background-color: #f1f1f1;
            color: #333;
        }

        .button.secondary:hover {
            background-color: #e0e0e0;
        }

        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        .search-bar {
            width: 60%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            border-color: #4285f4;
            box-shadow: 0 2px 10px rgba(66, 133, 244, 0.3);
        }

        .search-stats {
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #666;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .window {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .window-header {
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .window-content {
            padding: 0 15px 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .group {
            border-radius: 6px;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .group-header {
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-weight: 500;
        }

        .group-content {
            padding: 0 10px 10px;
        }

        .tab {
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 5px;
            background-color: white;
            display: flex;
            align-items: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tab-icon {
            margin-right: 10px;
            width: 16px;
            height: 16px;
            background-color: #ccc;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .tab-title {
            flex-grow: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .tab-url {
            color: #666;
            font-size: 0.85em;
            margin-left: 10px;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chevron {
            transition: transform 0.3s ease;
        }

        .chevron.up {
            transform: rotate(180deg);
        }

        .collapsed {
            display: none;
        }

        .standalone-tab {
            margin-left: 0;
        }

        .timestamp {
            font-size: 0.8em;
            color: #666;
            margin-left: 10px;
        }

        .highlight {
            background-color: #fff9c4;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            font-size: 1.1rem;
            color: #666;
        }

        .error-message {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.1rem;
            color: #666;
            display: none;
        }

        /* Window colors */
        .window-color-1 .window-header {
            background-color: #4285f4;
            color: white;
        }

        .window-color-1 .window-content {
            background-color: #e8f0fe;
        }

        .window-color-2 .window-header {
            background-color: #34a853;
            color: white;
        }

        .window-color-2 .window-content {
            background-color: #e6f4ea;
        }

        /* Group colors */
        .group-color-1 .group-header {
            background-color: #fbbc04;
            color: #333;
        }

        .group-color-1 .group-content {
            background-color: #fff8e1;
        }

        .group-color-2 .group-header {
            background-color: #ea4335;
            color: white;
        }

        .group-color-2 .group-content {
            background-color: #fdede9;
        }

        .group-color-3 .group-header {
            background-color: #9c27b0;
            color: white;
        }

        .group-color-3 .group-content {
            background-color: #f3e5f5;
        }

        .visualization-section {
            display: none;
        }

        .expand-collapse-all {
            margin-bottom: 15px;
            text-align: right;
        }
    </style>
</head>

<body>
    <h1>Browser Windows & Tabs Visualization</h1>

    <div class="input-section" id="inputSection">
        <h2>Enter Browser Data</h2>
        <p>Paste your JSON data below. The structure should match the example format shown.</p>
        <div class="error-message" id="errorMessage"></div>
        <textarea id="jsonInput" class="json-input"
            placeholder='Enter JSON with the structure: [{"windows": {"windowId": {"tabId": {"id": number, "index": number, "lastAccessed": number, "title": string, "url": string, "groupId"?: number}, ...}, ...}}]'></textarea>
        <div class="button-group">
            <button id="loadBtn" class="button">Load Data</button>
            <button id="loadSampleBtn" class="button secondary">Load Sample Data</button>
            <button id="clearBtn" class="button secondary">Clear</button>
        </div>
    </div>

    <div id="loadingIndicator" class="loading">Loading data...</div>

    <div class="visualization-section" id="visualizationSection">
        <div class="expand-collapse-all">
            <button id="expandAllBtn" class="button secondary">Expand All</button>
            <button id="collapseAllBtn" class="button secondary">Collapse All</button>
        </div>

        <div class="search-container">
            <input type="text" id="searchBar" class="search-bar" placeholder="Search for tabs by title or URL...">
        </div>

        <div id="searchStats" class="search-stats"></div>

        <div class="container" id="container"></div>
        <div id="noResults" class="no-results hidden">No tabs match your search.</div>

        <div class="button-group" style="margin-top: 20px;">
            <button id="backToInput" class="button secondary">Back to Input</button>
        </div>
    </div>

    <script>
        // Sample data to load if requested
        const sampleData = [
            {
                "windows": {
                    "2104794959": {
                        "2104331965": {
                            "id": 2104331965,
                            "index": 243,
                            "lastAccessed": 1729971922909.627,
                            "title": "login.steampowered.com",
                            "url": "https://login.steampowered.com/jwt/refresh?redir=https%3A%2F%2Fsteamcommunity.com%2Fapp%2F440900%2Fdiscussions%2F0%2F4700161192391741362%2F%3Fctp%3D3",
                        },
                        "2104331989": {
                            "groupId": 1777522509,
                            "id": 2104331989,
                            "index": 244,
                            "lastAccessed": 1729971913865.529,
                            "title": "Freya 's quest line is bugged - PlayStation Discussion / PlayStation Bug Reports - Funcom Forums",
                            "url": "https://forums.funcom.com/t/freya-s-quest-line-is-bugged/264869/23",
                        },
                        "2104332016": {
                            "groupId": 1777522509,
                            "id": 2104332016,
                            "index": 245,
                            "lastAccessed": 1729971920091.137,
                            "title": "Drowned Vault Armors deleted and missing from the game - PC Discussion / PC Bug Reports - Funcom Forums",
                            "url": "https://forums.funcom.com/t/drowned-vault-armors-deleted-and-missing-from-the-game/264514/8",
                        },
                        "2104332038": {
                            "groupId": 1777522509,
                            "id": 2104332038,
                            "index": 246,
                            "lastAccessed": 1729944862470.103,
                            "title": "Chairs too far away from tables T_T - Conan Exiles / PC Discussion - Funcom Forums",
                            "url": "https://forums.funcom.com/t/chairs-too-far-away-from-tables-t-t/265522",
                        }
                    },
                    "2104794961": {
                        "2104300576": {
                            "id": 2104300576,
                            "index": 741,
                            "lastAccessed": 1729364198818.772,
                            "title": "x.com/OskSta/status/1798310423554658732",
                            "url": "https://x.com/OskSta/status/1798310423554658732",
                        },
                        "2104333602": {
                            "id": 2104333602,
                            "index": 0,
                            "lastAccessed": 1712077091523.49,
                            "title": "WARNO Steam Key for PC - Buy now",
                            "url": "https://uk.gamesplanet.com/game/warno-steam-key--5471-1?utm_campaign=weekly&utm_content=toptitle&utm_medium=email&utm_source=2022-01-21",
                        }
                    }
                }
            }
        ];

        // Global variable to hold the current data
        let currentData = null;

        function formatTimestamp(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            return date.toLocaleString();
        }

        // Helper function to highlight the matching text
        function highlightText(text, searchTerm) {
            if (!searchTerm || !text) return text || '';

            const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }

        // Function to check if a tab matches the search query
        function tabMatchesSearch(tab, searchTerm) {
            if (!searchTerm) return true;

            const searchLower = searchTerm.toLowerCase();
            return (
                (tab.title && tab.title.toLowerCase().includes(searchLower)) ||
                (tab.url && tab.url.toLowerCase().includes(searchLower))
            );
        }

        function renderData(searchTerm = '') {
            if (!currentData) return;

            const container = document.getElementById('container');
            const noResultsElem = document.getElementById('noResults');
            const searchStatsElem = document.getElementById('searchStats');

            // Clear previous content
            container.innerHTML = '';

            // Process data
            const windows = currentData[0].windows;
            let windowIdx = 0;
            let totalTabsFound = 0;
            let totalTabs = 0;

            for (const windowId in windows) {
                windowIdx++;
                const windowColorClass = `window-color-${windowIdx % 2 + 1}`;
                const tabs = windows[windowId];
                let windowHasVisibleTabs = false;

                // Create window container
                const windowElem = document.createElement('div');
                windowElem.className = `window ${windowColorClass}`;

                // Add window header
                const windowHeader = document.createElement('div');
                windowHeader.className = 'window-header';
                windowHeader.innerHTML = `
          <div>Window ${windowIdx} (ID: ${windowId})</div>
          <div class="chevron">▼</div>
        `;
                windowHeader.addEventListener('click', () => {
                    const content = windowHeader.nextElementSibling;
                    content.classList.toggle('collapsed');
                    const chevron = windowHeader.querySelector('.chevron');
                    chevron.classList.toggle('up');
                });

                // Add window content
                const windowContent = document.createElement('div');
                windowContent.className = 'window-content';

                // Process tabs by groups
                const groups = {};
                const standaloneTabIds = [];

                // Identify groups and standalone tabs
                for (const tabId in tabs) {
                    const tab = tabs[tabId];
                    totalTabs++;

                    if (tab.groupId) {
                        if (!groups[tab.groupId]) {
                            groups[tab.groupId] = [];
                        }
                        groups[tab.groupId].push(tabId);
                    } else {
                        standaloneTabIds.push(tabId);
                    }
                }

                // Process groups
                let groupIdx = 0;
                for (const groupId in groups) {
                    groupIdx++;
                    const groupColorClass = `group-color-${groupIdx % 3 + 1}`;

                    const groupElem = document.createElement('div');
                    groupElem.className = `group ${groupColorClass}`;

                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'group-header';
                    groupHeader.innerHTML = `
            <div>Group (ID: ${groupId})</div>
            <div class="chevron">▼</div>
          `;
                    groupHeader.addEventListener('click', () => {
                        const content = groupHeader.nextElementSibling;
                        content.classList.toggle('collapsed');
                        const chevron = groupHeader.querySelector('.chevron');
                        chevron.classList.toggle('up');
                    });

                    const groupContent = document.createElement('div');
                    groupContent.className = 'group-content';

                    // Track if the group has any visible tabs after filtering
                    let groupHasVisibleTabs = false;

                    // Add tabs to group
                    groups[groupId].forEach(tabId => {
                        const tab = tabs[tabId];
                        const isVisible = tabMatchesSearch(tab, searchTerm);

                        if (isVisible) {
                            totalTabsFound++;
                            groupHasVisibleTabs = true;
                            windowHasVisibleTabs = true;

                            const tabElem = createTabElement(tab, false, searchTerm);
                            groupContent.appendChild(tabElem);
                        }
                    });

                    // Only add the group if it has visible tabs
                    if (groupHasVisibleTabs) {
                        groupElem.appendChild(groupHeader);
                        groupElem.appendChild(groupContent);
                        windowContent.appendChild(groupElem);

                        // Auto-expand groups when searching
                        if (searchTerm) {
                            groupContent.classList.remove('collapsed');
                            groupHeader.querySelector('.chevron').classList.add('up');
                        }
                    }
                }

                // Process standalone tabs
                standaloneTabIds.forEach(tabId => {
                    const tab = tabs[tabId];
                    const isVisible = tabMatchesSearch(tab, searchTerm);

                    if (isVisible) {
                        totalTabsFound++;
                        windowHasVisibleTabs = true;

                        const tabElem = createTabElement(tab, true, searchTerm);
                        windowContent.appendChild(tabElem);
                    }
                });

                // Only add the window if it has visible tabs
                if (windowHasVisibleTabs) {
                    windowElem.appendChild(windowHeader);
                    windowElem.appendChild(windowContent);
                    container.appendChild(windowElem);

                    // Auto-expand windows when searching
                    if (searchTerm) {
                        windowContent.classList.remove('collapsed');
                        windowHeader.querySelector('.chevron').classList.add('up');
                    }
                }
            }

            // Update search stats
            if (searchTerm) {
                searchStatsElem.textContent = `Found ${totalTabsFound} matching tabs out of ${totalTabs} total tabs`;
                searchStatsElem.classList.remove('hidden');
            } else {
                searchStatsElem.textContent = '';
                searchStatsElem.classList.add('hidden');
            }

            // Show no results message if needed
            if (totalTabsFound === 0 && searchTerm) {
                noResultsElem.classList.remove('hidden');
            } else {
                noResultsElem.classList.add('hidden');
            }
        }

        function createTabElement(tab, isStandalone = false, searchTerm = '') {
            const tabElem = document.createElement('div');
            tabElem.className = `tab ${isStandalone ? 'standalone-tab' : ''}`;

            // Highlight the matching text parts if there's a search term
            const highlightedTitle = highlightText(tab.title || 'Untitled', searchTerm);
            const displayUrl = tab.url ? (tab.url.length > 40 ? tab.url.substring(0, 40) + '...' : tab.url) : 'No URL';
            const highlightedUrl = highlightText(displayUrl, searchTerm);

            tabElem.innerHTML = `
        <div class="tab-icon"></div>
        <div class="tab-title" title="${tab.title || 'Untitled'}">${highlightedTitle}</div>
        <div class="tab-url" title="${tab.url || ''}">${highlightedUrl}</div>
        <div class="timestamp">${formatTimestamp(tab.lastAccessed)}</div>
      `;

            return tabElem;
        }

        function validateAndLoadData() {
            const jsonInput = document.getElementById('jsonInput').value.trim();
            const errorMessageElem = document.getElementById('errorMessage');
            const loadingIndicator = document.getElementById('loadingIndicator');

            // Clear previous error
            errorMessageElem.style.display = 'none';

            if (!jsonInput) {
                errorMessageElem.textContent = 'Please enter JSON data.';
                errorMessageElem.style.display = 'block';
                return;
            }

            try {
                loadingIndicator.style.display = 'block';

                // Use setTimeout to allow the loading indicator to render before processing
                setTimeout(() => {
                    const data = JSON.parse(jsonInput);

                    // Validate basic structure
                    if (!Array.isArray(data) || !data[0] || !data[0].windows) {
                        throw new Error('Invalid data format. Expected an array with a "windows" object.');
                    }

                    // Update global data
                    currentData = data;

                    // Switch to visualization section
                    document.getElementById('inputSection').style.display = 'none';
                    document.getElementById('visualizationSection').style.display = 'block';

                    // Render the data
                    renderData();

                    // Hide loading indicator
                    loadingIndicator.style.display = 'none';
                }, 10);

            } catch (error) {
                loadingIndicator.style.display = 'none';
                errorMessageElem.textContent = `Error: ${error.message}. Please check your JSON format.`;
                errorMessageElem.style.display = 'block';
            }
        }

        function loadSampleData() {
            document.getElementById('jsonInput').value = JSON.stringify(sampleData, null, 2);
        }

        function clearInput() {
            document.getElementById('jsonInput').value = '';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function expandAll() {
            const collapseElements = document.querySelectorAll('.window-content, .group-content');
            const chevrons = document.querySelectorAll('.chevron');

            collapseElements.forEach(elem => {
                elem.classList.remove('collapsed');
            });

            chevrons.forEach(chevron => {
                chevron.classList.add('up');
            });
        }

        function collapseAll() {
            const collapseElements = document.querySelectorAll('.window-content, .group-content');
            const chevrons = document.querySelectorAll('.chevron');

            collapseElements.forEach(elem => {
                elem.classList.add('collapsed');
            });

            chevrons.forEach(chevron => {
                chevron.classList.remove('up');
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set up button handlers
            document.getElementById('loadBtn').addEventListener('click', validateAndLoadData);
            document.getElementById('loadSampleBtn').addEventListener('click', loadSampleData);
            document.getElementById('clearBtn').addEventListener('click', clearInput);
            document.getElementById('backToInput').addEventListener('click', () => {
                document.getElementById('inputSection').style.display = 'block';
                document.getElementById('visualizationSection').style.display = 'none';
            });
            document.getElementById('expandAllBtn').addEventListener('click', expandAll);
            document.getElementById('collapseAllBtn').addEventListener('click', collapseAll);

            // Set up search functionality
            const searchBar = document.getElementById('searchBar');

            searchBar.addEventListener('input', (e) => {
                const searchTerm = e.target.value.trim();
                renderData(searchTerm);
            });

            // Clear search when pressing Escape
            searchBar.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    searchBar.value = '';
                    renderData();
                }
            });
        });
    </script>
</body>

</html>
